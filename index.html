<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MangoSwap - Automate Your Trades</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-orange-100 via-yellow-50 to-green-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <div class="bg-white rounded-xl shadow-xl p-6 mb-8 border-4 border-orange-300">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div>
                    <h1 class="text-4xl font-bold bg-gradient-to-r from-orange-500 via-yellow-500 to-green-500 bg-clip-text text-transparent">ü•≠ MangoSwap</h1>
                    <p class="text-gray-700 mt-1 font-medium">Sweet Swaps on Base üå¥</p>
                </div>
                <button id="connectBtn" class="bg-gradient-to-r from-orange-500 to-yellow-500 hover:from-orange-600 hover:to-yellow-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg transition transform hover:scale-105">Connect Wallet</button>
                <div id="accountInfo" class="hidden text-right">
                    <div class="text-sm text-gray-600">Connected</div>
                    <div id="accountAddress" class="font-mono text-sm bg-orange-100 px-3 py-1 rounded-lg border-2 border-orange-300"></div>
                </div>
            </div>
        </div>
        <div id="mainContent" class="hidden">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-lg p-6 border-2 border-orange-200">
                    <div class="text-sm text-orange-700 font-semibold">Total Swaps</div>
                    <div id="totalSwaps" class="text-3xl font-bold text-orange-600">0</div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6 border-2 border-yellow-200">
                    <div class="text-sm text-yellow-700 font-semibold">Scheduled</div>
                    <div id="scheduledCount" class="text-3xl font-bold text-yellow-600">0</div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6 border-2 border-green-200">
                    <div class="text-sm text-green-700 font-semibold">Executed</div>
                    <div id="executedCount" class="text-3xl font-bold text-green-600">0</div>
                </div>
                <div id="ownerStats" class="bg-white rounded-xl shadow-lg p-6 border-2 border-emerald-200 hidden">
                    <button id="withdrawBtn" class="w-full bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white px-4 py-2 rounded-lg text-sm transition font-bold shadow-md" style="display:none;">üí∞ Withdraw</button>
                </div>
            </div>
            <div class="bg-white rounded-2xl shadow-2xl overflow-hidden border-4 border-orange-300">
                <div class="flex border-b-4 border-orange-200">
                    <button id="scheduleTab" class="flex-1 px-6 py-4 font-bold bg-gradient-to-r from-orange-500 to-yellow-500 text-white text-lg">Schedule Swap</button>
                    <button id="swapsTab" class="flex-1 px-6 py-4 font-bold text-gray-600 hover:bg-orange-50 text-lg transition">My Swaps</button>
                </div>
                <div id="scheduleContent" class="p-6 bg-gradient-to-br from-orange-50 to-yellow-50">
                    <div class="bg-gradient-to-r from-orange-100 to-yellow-100 border-2 border-orange-300 rounded-xl p-4 mb-6">
                        <p class="text-sm text-orange-900 font-medium">üå¥ <strong>How it works:</strong> Schedule your token swaps to execute automatically at your chosen time. Perfect for DCA strategies, timed entries/exits, or avoiding emotional trading!</p>
                    </div>
                    <div class="max-w-lg mx-auto space-y-4">
                        <div class="bg-white border-3 border-orange-300 rounded-2xl p-4 shadow-lg">
                            <div class="flex justify-between items-center mb-2">
                                <label class="text-sm font-bold text-orange-700">From</label>
                            </div>
                            <div class="flex items-center gap-3">
                                <input type="number" step="0.001" id="amountIn" placeholder="0.0" class="flex-1 text-3xl font-bold bg-transparent border-none outline-none text-gray-800">
                                <select id="tokenIn" class="bg-gradient-to-r from-orange-100 to-yellow-100 border-3 border-orange-300 rounded-xl px-4 py-2 font-bold text-lg hover:border-orange-400 transition cursor-pointer flex-shrink-0">
                                    <option value="0x0000000000000000000000000000000000000000">ETH</option>
                                    <option value="0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913">USDC</option>
                                    <option value="0x50c5725949A6F0c72E6C4a641F24049A917DB0Cb">DAI</option>
                                    <option value="0x532f27101965dd16442E59d40670FaF5eBB142E4">BRETT</option>
                                    <option value="0x940181a94A35A4569E4529A3CDfB74e38FD98631">AERO</option>
                                    <option value="0xAC1Bd2486aAf3B5C0fc3Fd868558b082a531B2B4">TOSHI</option>
                                    <option value="0x4ed4E862860beD51a9570b96d89aF5E1B0Efefed">DEGEN</option>
                                    <option value="0xA88594D404727625A9437C3f886C7643872296AE">WELL</option>
                                    <option value="0x0b3e328455c4059EEb9e3f84b5543F74E24e7E1b">VIRTUAL</option>
                                    <option value="0x78a087d713Be963Bf307b18F2Ff8122EF9A63ae9">ZORA</option>
                                    <option value="0x5F62728a88AEC4878E68DCf5c48dFf3a5d8f8b8E">AUKI</option>
                                    <option value="0x3C7f2d20C05C1Da0479D1A2B21AB899e1D7c8e3E">CLANKER</option>
                                    <option value="0x05C2ec8e2f5d1e8E05e49BdD0C8cf05c6e3FAC1B">GAME</option>
                                    <option value="0x8dEa9B7E7F3a5e6b4E9A5F6d7E3a9B4C5d6E7F8A">DRB</option>
                                    <option value="custom">Custom...</option>
                                </select>
                            </div>
                            <input type="text" id="customTokenIn" placeholder="Paste token address (0x...)" class="hidden w-full mt-3 px-3 py-2 border-2 border-orange-200 rounded-lg text-sm">
                        </div>
                        <div class="flex justify-center -my-2 relative z-10">
                            <button id="swapArrow" class="bg-gradient-to-r from-orange-500 to-yellow-500 hover:from-orange-600 hover:to-yellow-600 text-white rounded-xl p-3 shadow-xl transition transform hover:scale-110 hover:rotate-180 duration-300 border-3 border-white">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="bg-white border-3 border-green-300 rounded-2xl p-4 shadow-lg">
                            <div class="flex justify-between items-center mb-2">
                                <label class="text-sm font-bold text-green-700">To (estimated)</label>
                                <div id="priceLoading" class="hidden text-xs text-orange-600 font-semibold">Fetching price...</div>
                            </div>
                            <div class="flex items-center gap-3">
                                <div class="flex-1 text-3xl font-bold text-gray-800" id="estimatedAmount">0.0</div>
                                <input type="number" step="0.001" id="minAmountOut" placeholder="0.0" class="hidden">
                                <select id="tokenOut" class="bg-gradient-to-r from-green-100 to-emerald-100 border-3 border-green-300 rounded-xl px-4 py-2 font-bold text-lg hover:border-green-400 transition cursor-pointer flex-shrink-0">
                                    <option value="0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913">USDC</option>
                                    <option value="0x0000000000000000000000000000000000000000">ETH</option>
                                    <option value="0x50c5725949A6F0c72E6C4a641F24049A917DB0Cb">DAI</option>
                                    <option value="0x532f27101965dd16442E59d40670FaF5eBB142E4">BRETT</option>
                                    <option value="0x940181a94A35A4569E4529A3CDfB74e38FD98631">AERO</option>
                                    <option value="0xAC1Bd2486aAf3B5C0fc3Fd868558b082a531B2B4">TOSHI</option>
                                    <option value="0x4ed4E862860beD51a9570b96d89aF5E1B0Efefed">DEGEN</option>
                                    <option value="0xA88594D404727625A9437C3f886C7643872296AE">WELL</option>
                                    <option value="0x0b3e328455c4059EEb9e3f84b5543F74E24e7E1b">VIRTUAL</option>
                                    <option value="0x78a087d713Be963Bf307b18F2Ff8122EF9A63ae9">ZORA</option>
                                    <option value="0x5F62728a88AEC4878E68DCf5c48dFf3a5d8f8b8E">AUKI</option>
                                    <option value="0x3C7f2d20C05C1Da0479D1A2B21AB899e1D7c8e3E">CLANKER</option>
                                    <option value="0x05C2ec8e2f5d1e8E05e49BdD0C8cf05c6e3FAC1B">GAME</option>
                                    <option value="0x8dEa9B7E7F3a5e6b4E9A5F6d7E3a9B4C5d6E7F8A">DRB</option>
                                    <option value="custom">Custom...</option>
                                </select>
                            </div>
                            <input type="text" id="customTokenOut" placeholder="Paste token address (0x...)" class="hidden w-full mt-3 px-3 py-2 border-2 border-green-200 rounded-lg text-sm">
                            <div id="priceInfo" class="mt-3 space-y-1 text-sm hidden bg-green-50 p-3 rounded-lg border border-green-200">
                                <div class="flex justify-between text-green-800">
                                    <span class="font-semibold">Exchange Rate:</span>
                                    <span id="exchangeRate" class="font-bold">-</span>
                                </div>
                                <div class="flex justify-between text-green-800">
                                    <span class="font-semibold">Minimum received (5% slippage):</span>
                                    <span id="minReceived" class="font-bold">-</span>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gradient-to-r from-yellow-50 to-orange-50 border-3 border-yellow-300 rounded-2xl p-4 mt-6 shadow-lg">
                            <h3 class="font-bold text-orange-800 mb-3 text-lg">‚è∞ Execution Time</h3>
                            <div class="space-y-2 mb-3">
                                <label class="flex items-center space-x-3 cursor-pointer bg-white p-3 rounded-xl hover:bg-yellow-50 transition border-2 border-yellow-200">
                                    <input type="radio" name="timeOption" value="now" id="timeNow" class="w-5 h-5 text-orange-600">
                                    <span class="font-bold text-gray-800">Execute Now (Instant Swap)</span>
                                </label>
                                <label class="flex items-center space-x-3 cursor-pointer bg-white p-3 rounded-xl hover:bg-yellow-50 transition border-2 border-yellow-200">
                                    <input type="radio" name="timeOption" value="scheduled" id="timeScheduled" checked class="w-5 h-5 text-orange-600">
                                    <span class="font-bold text-gray-800">Schedule for Later</span>
                                </label>
                            </div>
                            <div id="scheduledTimeInputs" class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-bold text-orange-700 mb-1">Date</label>
                                    <input type="date" id="executionDate" class="w-full px-3 py-2 border-3 border-orange-200 rounded-xl font-semibold">
                                </div>
                                <div>
                                    <label class="block text-sm font-bold text-orange-700 mb-1">Time</label>
                                    <input type="time" id="executionTime" class="w-full px-3 py-2 border-3 border-orange-200 rounded-xl font-semibold">
                                </div>
                            </div>
                            <p id="scheduledTimeNote" class="text-sm text-orange-800 mt-2 font-medium">Executes automatically at this time (within 1 hour window)</p>
                            <p id="instantTimeNote" class="text-sm text-orange-800 mt-2 font-medium hidden">Swap executes immediately after confirmation</p>
                        </div>
                        <div class="bg-gradient-to-r from-green-100 to-emerald-100 rounded-xl p-4 border-2 border-green-300">
                            <div class="flex justify-between text-sm mb-1">
                                <span class="text-green-800 font-semibold">Platform Fee</span>
                                <span class="font-bold text-green-900">0.3%</span>
                            </div>
                            <div class="flex justify-between text-sm mb-1">
                                <span class="text-green-800 font-semibold">Execution Fee</span>
                                <span class="font-bold text-green-900">0.2%</span>
                            </div>
                            <div class="flex justify-between text-sm pt-2 border-t-2 border-green-300">
                                <span class="font-bold text-green-900">Total Fee</span>
                                <span class="font-bold text-orange-600 text-lg">0.5%</span>
                            </div>
                        </div>
                        <button id="scheduleSwapBtn" class="w-full bg-gradient-to-r from-orange-500 via-yellow-500 to-green-500 hover:from-orange-600 hover:via-yellow-600 hover:to-green-600 text-white font-black py-5 rounded-2xl transition text-xl shadow-2xl transform hover:scale-105 border-4 border-white">ü•≠ Schedule Swap üå¥</button>
                    </div>
                </div>
                <div id="swapsContent" class="p-6 hidden">
                    <div id="swapsList"></div>
                </div>
            </div>
        </div>
    </div>
    <script>
        const CONTRACT_ADDRESS='0xde6d1499acfb534b36b31e2f1efff90d5af819d7';const BASE_CHAIN_ID='0x2105';const ABI=["function scheduleSwap(address,address,uint256,uint256,uint256) external payable returns(uint256)","function cancelSwap(uint256) external","function getSwap(uint256) external view returns(tuple(uint256,address,address,address,uint256,uint256,uint256,uint8,uint256,uint256))","function getUserSwaps(address) external view returns(uint256[])","function getTotalSwaps() external view returns(uint256)","function withdrawFees() external","function owner() external view returns(address)"];const TOKENS={'0x0000000000000000000000000000000000000000':'ETH','0x833589fcd6edb6e08f4c7c32d4f71b54bda02913':'USDC','0x50c5725949a6f0c72e6c4a641f24049a917db0cb':'DAI','0x532f27101965dd16442e59d40670faf5ebb142e4':'BRETT','0x940181a94a35a4569e4529a3cdfb74e38fd98631':'AERO','0xac1bd2486aaf3b5c0fc3fd868558b082a531b2b4':'TOSHI','0x4ed4e862860bed51a9570b96d89af5e1b0efefed':'DEGEN','0xa88594d404727625a9437c3f886c7643872296ae':'WELL','0x0b3e328455c4059eeb9e3f84b5543f74e24e7e1b':'VIRTUAL','0x78a087d713be963bf307b18f2ff8122ef9a63ae9':'ZORA','0x5f62728a88aec4878e68dcf5c48dff3a5d8f8b8e':'AUKI','0x3c7f2d20c05c1da0479d1a2b21ab899e1d7c8e3e':'CLANKER','0x05c2ec8e2f5d1e8e05e49bdd0c8cf05c6e3fac1b':'GAME','0x8dea9b7e7f3a5e6b4e9a5f6d7e3a9b4c5d6e7f8a':'DRB'};const WETH='0x4200000000000000000000000000000000000006';let provider,signer,contract,account,isOwner=false,quoteTimeout;document.getElementById('connectBtn').addEventListener('click',connectWallet);document.getElementById('scheduleTab').addEventListener('click',()=>switchTab('schedule'));document.getElementById('swapsTab').addEventListener('click',()=>switchTab('swaps'));document.getElementById('scheduleSwapBtn').addEventListener('click',scheduleSwap);document.getElementById('amountIn').addEventListener('input',debounceQuote);document.getElementById('tokenIn').addEventListener('change',getQuote);document.getElementById('tokenOut').addEventListener('change',getQuote);document.getElementById('swapArrow').addEventListener('click',function(){const tokenInSelect=document.getElementById('tokenIn');const tokenOutSelect=document.getElementById('tokenOut');const tempValue=tokenInSelect.value;tokenInSelect.value=tokenOutSelect.value;tokenOutSelect.value=tempValue;getQuote()});document.getElementById('tokenIn').addEventListener('change',function(){if(this.value==='custom'){document.getElementById('customTokenIn').classList.remove('hidden')}else{document.getElementById('customTokenIn').classList.add('hidden')}});document.getElementById('tokenOut').addEventListener('change',function(){if(this.value==='custom'){document.getElementById('customTokenOut').classList.remove('hidden')}else{document.getElementById('customTokenOut').classList.add('hidden')}});document.getElementById('timeNow').addEventListener('change',function(){if(this.checked){document.getElementById('scheduledTimeInputs').classList.add('hidden');document.getElementById('scheduledTimeNote').classList.add('hidden');document.getElementById('instantTimeNote').classList.remove('hidden')}});document.getElementById('timeScheduled').addEventListener('change',function(){if(this.checked){document.getElementById('scheduledTimeInputs').classList.remove('hidden');document.getElementById('scheduledTimeNote').classList.remove('hidden');document.getElementById('instantTimeNote').classList.add('hidden')}});async function connectWallet(){if(!window.ethereum){alert('Install MetaMask!');return}try{const accounts=await window.ethereum.request({method:'eth_requestAccounts'});const chainId=await window.ethereum.request({method:'eth_chainId'});if(chainId!==BASE_CHAIN_ID){try{await window.ethereum.request({method:'wallet_switchEthereumChain',params:[{chainId:BASE_CHAIN_ID}]})}catch(e){if(e.code===4902){await window.ethereum.request({method:'wallet_addEthereumChain',params:[{chainId:BASE_CHAIN_ID,chainName:'Base',nativeCurrency:{name:'ETH',symbol:'ETH',decimals:18},rpcUrls:['https://mainnet.base.org'],blockExplorerUrls:['https://basescan.org']}]})}}}account=accounts[0];provider=new ethers.providers.Web3Provider(window.ethereum);signer=provider.getSigner();contract=new ethers.Contract(CONTRACT_ADDRESS,ABI,signer);document.getElementById('connectBtn').classList.add('hidden');document.getElementById('accountInfo').classList.remove('hidden');document.getElementById('accountAddress').textContent=account.slice(0,6)+'...'+account.slice(-4);document.getElementById('mainContent').classList.remove('hidden');const owner=await contract.owner();isOwner=owner.toLowerCase()===account.toLowerCase();if(isOwner){document.getElementById('ownerStats').classList.remove('hidden');document.getElementById('withdrawBtn').style.display='block'}loadData()}catch(e){alert('Failed: '+e.message)}}async function loadData(){try{const total=await contract.getTotalSwaps();document.getElementById('totalSwaps').textContent=total.toString();const ids=await contract.getUserSwaps(account);const swaps=await Promise.all(ids.map(async id=>{const s=await contract.getSwap(id);return{id:s[0].toString(),user:s[1],tokenIn:s[2],tokenOut:s[3],amountIn:ethers.utils.formatEther(s[4]),minAmountOut:ethers.utils.formatEther(s[5]),executionTime:new Date(s[6].toNumber()*1000),status:['Scheduled','Executed','Cancelled','Failed'][s[7]],executedAt:s[8].toNumber(),amountOut:ethers.utils.formatEther(s[9])}}));const scheduled=swaps.filter(s=>s.status==='Scheduled').length;const executed=swaps.filter(s=>s.status==='Executed').length;document.getElementById('scheduledCount').textContent=scheduled;document.getElementById('executedCount').textContent=executed;displaySwaps(swaps)}catch(e){console.error(e)}}function displaySwaps(swaps){const list=document.getElementById('swapsList');if(swaps.length===0){list.innerHTML='<div class="text-center py-12 text-gray-500"><p>No swaps scheduled yet!</p></div>';return}list.innerHTML=swaps.map(s=>{const tokenInName=TOKENS[s.tokenIn.toLowerCase()]||s.tokenIn.slice(0,6)+'...';const tokenOutName=TOKENS[s.tokenOut.toLowerCase()]||s.tokenOut.slice(0,6)+'...';return`<div class="border-2 border-orange-200 rounded-xl p-6 mb-4 bg-white shadow-lg"><div class="flex justify-between mb-4"><span class="px-3 py-1 rounded-full text-sm font-semibold ${s.status==='Scheduled'?'bg-yellow-100 text-yellow-800':s.status==='Executed'?'bg-green-100 text-green-800':'bg-gray-100 text-gray-800'}">${s.status}</span><div class="text-right"><div class="font-bold text-lg">${s.amountIn} ${tokenInName} ‚Üí ${tokenOutName}</div><div class="text-sm text-gray-600">Min: ${s.minAmountOut} ${tokenOutName}</div></div></div><div class="grid grid-cols-2 gap-4 text-sm mb-4"><div><span class="text-gray-600">Executes:</span><div class="font-semibold">${s.executionTime.toLocaleString()}</div></div>${s.status==='Executed'?`<div><span class="text-gray-600">Received:</span><div class="font-semibold text-green-600">${s.amountOut} ${tokenOutName}</div></div>`:''}</div>${s.status==='Scheduled'?`<button onclick="cancelSwap(${s.id})" class="w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white py-2 rounded-lg font-bold transition">Cancel Swap</button>`:''}</div>`}).join('')}async function scheduleSwap(){let tokenIn=document.getElementById('tokenIn').value;let tokenOut=document.getElementById('tokenOut').value;if(tokenIn==='custom'){tokenIn=document.getElementById('customTokenIn').value.trim();if(!tokenIn||!tokenIn.startsWith('0x')||tokenIn.length!==42){alert('Invalid token address for From Token');return}}if(tokenOut==='custom'){tokenOut=document.getElementById('customTokenOut').value.trim();if(!tokenOut||!tokenOut.startsWith('0x')||tokenOut.length!==42){alert('Invalid token address for To Token');return}}const amount=document.getElementById('amountIn').value;const minOut=document.getElementById('minAmountOut').value;if(!amount||!minOut){alert('Fill all fields');return}if(tokenIn===tokenOut){alert('Select different tokens');return}const isInstant=document.getElementById('timeNow').checked;let execTime;if(isInstant){execTime=Math.floor(Date.now()/1000)+60}else{const date=document.getElementById('executionDate').value;const time=document.getElementById('executionTime').value;if(!date||!time){alert('Please set execution date and time');return}execTime=Math.floor(new Date(date+' '+time).getTime()/1000)}try{const amountWei=ethers.utils.parseEther(amount);const minOutWei=ethers.utils.parseEther(minOut);const tx=tokenIn==='0x0000000000000000000000000000000000000000'?await contract.scheduleSwap(tokenIn,tokenOut,amountWei,minOutWei,execTime,{value:amountWei}):await contract.scheduleSwap(tokenIn,tokenOut,amountWei,minOutWei,execTime);await tx.wait();alert(isInstant?'Swap scheduled for immediate execution!':'Swap scheduled!');document.getElementById('amountIn').value='';document.getElementById('minAmountOut').value='';document.getElementById('executionDate').value='';document.getElementById('executionTime').value='';loadData()}catch(e){alert('Failed: '+e.message)}}async function cancelSwap(id){try{const tx=await contract.cancelSwap(id);await tx.wait();alert('Cancelled!');loadData()}catch(e){alert('Failed: '+e.message)}}function switchTab(tab){if(tab==='schedule'){document.getElementById('scheduleTab').classList.add('bg-gradient-to-r','from-orange-500','to-yellow-500','text-white');document.getElementById('scheduleTab').classList.remove('text-gray-600');document.getElementById('swapsTab').classList.remove('bg-gradient-to-r','from-orange-500','to-yellow-500','text-white');document.getElementById('swapsTab').classList.add('text-gray-600');document.getElementById('scheduleContent').classList.remove('hidden');document.getElementById('swapsContent').classList.add('hidden')}else{document.getElementById('swapsTab').classList.add('bg-gradient-to-r','from-orange-500','to-yellow-500','text-white');document.getElementById('swapsTab').classList.remove('text-gray-600');document.getElementById('scheduleTab').classList.remove('bg-gradient-to-r','from-orange-500','to-yellow-500','text-white');document.getElementById('scheduleTab').classList.add('text-gray-600');document.getElementById('swapsContent').classList.remove('hidden');document.getElementById('scheduleContent').classList.add('hidden')}}document.getElementById('withdrawBtn')?.addEventListener('click',async()=>{try{const tx=await contract.withdrawFees();await tx.wait();alert('Fees withdrawn!')}catch(e){alert('Failed: '+e.message)}});function debounceQuote(){clearTimeout(quoteTimeout);quoteTimeout=setTimeout(getQuote,500)}async function getQuote(){const amountIn=document.getElementById('amountIn').value;let tokenIn=document.getElementById('tokenIn').value;let tokenOut=document.getElementById('tokenOut').value;if(!amountIn||amountIn<=0 ||tokenIn===tokenOut){document.getElementById('estimatedAmount').textContent='0.0';document.getElementById('priceInfo').classList.add('hidden');return}if(tokenIn==='custom')tokenIn=document.getElementById('customTokenIn').value.trim();if(tokenOut==='custom')tokenOut=document.getElementById('customTokenOut').value.trim();if(!tokenIn||!tokenOut)return;try{document.getElementById('priceLoading').classList.remove('hidden');document.getElementById('priceInfo').classList.add('hidden');const tokenInAddr=tokenIn==='0x0000000000000000000000000000000000000000'?WETH:tokenIn;const tokenOutAddr=tokenOut==='0x0000000000000000000000000000000000000000'?WETH:tokenOut;const response=await fetch(`https://api.dexscreener.com/latest/dex/tokens/${tokenInAddr}`);const data=await response.json();let price=0;if(data&&data.pairs&&data.pairs.length>0){const pair=data.pairs[0];price=parseFloat(pair.priceUsd)}const response2=await fetch(`https://api.dexscreener.com/latest/dex/tokens/${tokenOutAddr}`);const data2=await response2.json();let price2=0;if(data2&&data2.pairs&&data2.pairs.length>0){const pair2=data2.pairs[0];price2=parseFloat(pair2.priceUsd)}if(price>0&&price2>0){const estimated=(parseFloat(amountIn)*price)/price2;const minOut=estimated*0.95;document.getElementById('estimatedAmount').textContent=estimated.toFixed(6);document.getElementById('minAmountOut').value=minOut.toFixed(6);const tokenInName=TOKENS[tokenIn.toLowerCase()]||'Token';const tokenOutName=TOKENS[tokenOut.toLowerCase()]||'Token';const rate=(estimated/parseFloat(amountIn)).toFixed(6);document.getElementById('exchangeRate').textContent=`1 ${tokenInName} = ${rate} ${tokenOutName}`;document.getElementById('minReceived').textContent=`${minOut.toFixed(6)} ${tokenOutName}`;document.getElementById('priceInfo').classList.remove('hidden')}else{document.getElementById('estimatedAmount').textContent='0.0'}document.getElementById('priceLoading').classList.add('hidden')}catch(error){console.error('Price fetch error:',error);document.getElementById('estimatedAmount').textContent='~';document.getElementById('priceLoading').classList.add('hidden')}}
    </script>
</body>
</html>
